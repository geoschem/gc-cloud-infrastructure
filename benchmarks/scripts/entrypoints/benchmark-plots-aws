#!/bin/bash



set -u
cd ${GEOSCHEM_BENCHMARK_SCRIPTS}

. /etc/bashrc

set -u
set -e
set -x

: "${GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY}"        # primary key of ref in the database
: "${GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY}"        # primary key of dev in the database

GEOSCHEM_BENCHMARK_COMMIT_ID=${GEOSCHEM_BENCHMARK_COMMIT_ID}
GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY="${GEOSCHEM_BENCHMARK_MODEL}-${GEOSCHEM_BENCHMARK_TIME_PERIOD}-${GEOSCHEM_BENCHMARK_INSTANCE_ID}.bd"
GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY=$1
GEOSCHEM_BENCHMARK_INSTANCE_ID=bmp.${GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY}_${GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY}
export GEOSCHEM_BENCHMARK_MODEL=gchp
export GEOSCHEM_BENCHMARK_INSTANCE_ID=${GEOSCHEM_BENCHMARK_INSTANCE_ID}
export GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY=${GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY}
export GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY=${GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY}
export GEOSCHEM_BENCHMARK_INSTANCE_DESCRIPTION="GCHP benchmark plot creation (ref: '${GEOSCHEM_BENCHMARK_REF_PRIMARY_KEY}'; dev:'${GEOSCHEM_BENCHMARK_DEV_PRIMARY_KEY}')"
export GEOSCHEM_BENCHMARK_SITE=AWS
export GEOSCHEM_BENCHMARK_S3_BUCKET=s3://benchmarks-cloud
export GEOSCHEM_BENCHMARK_TABLE_NAME=geoschem_testing

case ${GEOSCHEM_BENCHMARK_TIME_PERIOD} in
    1Hr)
        export GEOSCHEM_BENCHMARK_PLOT_CONFIG_FILE=${GEOSCHEM_BENCHMARK_SCRIPTS}/stages/resources/template.1Hr_benchmark_${GEOSCHEM_BENCHMARK_MODEL}.yml
        ;;
    1Day)

        ;;
    1Mon)

        ;;
    *)
        >&2 echo "error: unknown time period '${GEOSCHEM_BENCHMARK_TIME_PERIOD}' (GEOSCHEM_BENCHMARK_TIME_PERIOD)"
        exit 1
        ;;
esac

./helpers/dbCreateTest.sh || echo "Test already exists"
./stages/createBenchmarkPlots.sh

EOF
